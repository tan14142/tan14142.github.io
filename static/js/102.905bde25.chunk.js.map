{"version":3,"sources":["Projects/BreakingBadAPI.tsx"],"names":["BreakingBadAPI","selectRef","useRef","useState","episodes","setEpisodes","characters","setCharacters","highlight","setHighlight","useBreakingBadAPI","reduced","key","character","length","some","substring","includes","push","sort","useEffect","M","FormSelect","init","current","className","Timeline","defaultValue","value","onChange","e","target","ref","disabled","map","svgRef","height","clientHeight","width","clientWidth","maxDate","max","episode","getDate","air_date","minDate","min","xScale","scaleTime","domain","range","yScale","scaleLinear","xAxis","axisBottom","svg","select","selectAll","call","styles","transform","data","join","attrs","class","x1","x2","y1","y2","transition","stroke","interrupt","style","borderRight","borderTop","overflow","date","split","Date","query","callback","savedCallback","controller","AbortController","signal","fetch","then","response","ok","json","catch","name","console","log","warn","abort"],"mappings":"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","file":"static/js/102.905bde25.chunk.js","sourcesContent":["import { useEffect, useRef, useState } from 'react';\r\nimport { axisBottom, max, min, scaleLinear, scaleTime, select } from 'd3';\r\nimport M from 'materialize-css';\r\nimport 'd3-selection-multi';\r\n\r\nexport default function BreakingBadAPI() {\r\n  \r\n  const selectRef = useRef(),\r\n        [episodes, setEpisodes] = useState([]),\r\n        [characters, setCharacters] = useState([]),\r\n        [highlight, setHighlight] = useState();\r\n  \r\n  useBreakingBadAPI(\r\n    'episodes?series',\r\n    episodes => {\r\n      let reduced = {};\r\n      \r\n      for (const key in episodes) {\r\n        for (const character in episodes[key].characters) {\r\n          if (episodes[key].characters[character].length\r\n          && ![\r\n            'fly',\r\n            'Erhmantraut',\r\n            'White White'\r\n            ].some(substring => episodes[key].characters[character]\r\n              .includes(substring)\r\n            )\r\n          ) {\r\n            reduced[episodes[key].characters[character]] = null;\r\n          }\r\n        }\r\n      }\r\n      \r\n      let characters = [];\r\n      \r\n      for (const character in reduced) {\r\n        characters.push(character);\r\n      }\r\n      \r\n      characters.sort();\r\n      \r\n      setCharacters(characters);\r\n      setEpisodes(episodes);\r\n    }\r\n  );\r\n  useEffect(() => {\r\n    M.FormSelect.init(selectRef.current, {});\r\n  }, []);\r\n  \r\n  return (\r\n    <section className=\"panel center\">\r\n      <h2>Breaking Bad Timeline</h2>\r\n      <Timeline episodes={episodes} highlight={highlight} />\r\n      <div className=\"input-field\">\r\n        <select\r\n        className=\"browser-default btn center-content\"\r\n        defaultValue=\"0\"\r\n        value={highlight}\r\n        onChange={e => setHighlight(e.target.value)}\r\n        ref={selectRef}>\r\n          <option disabled value=\"0\">Choose your character</option>\r\n          {characters.map(character => (\r\n          <option key={character} value={character}>{character}</option>\r\n          ))}\r\n        </select>\r\n      </div>\r\n    </section>\r\n  );\r\n};\r\n\r\nconst Timeline = ({ episodes, highlight }) => {\r\n  \r\n  const svgRef = useRef();\r\n  \r\n  useEffect(() => {\r\n    \r\n    const height = svgRef.current.clientHeight,\r\n          width = svgRef.current.clientWidth,\r\n    \r\n          maxDate = max(episodes, episode => getDate(episode.air_date)),\r\n          minDate = min(episodes, episode => getDate(episode.air_date)),\r\n\r\n          xScale = scaleTime()\r\n            .domain([minDate, maxDate])\r\n            .range([0, width]),\r\n          yScale = scaleLinear()\r\n            .domain([max(episodes, episode => episode.characters.length), 0])\r\n            .range([0 , height]),\r\n          \r\n          xAxis = axisBottom(xScale),\r\n          \r\n          svg = select(svgRef.current);\r\n          \r\n    svg\r\n      .selectAll('.xAxis')\r\n      .call(xAxis)\r\n      .styles({\r\n        transform : `translateY(${height}px)`\r\n      });\r\n    \r\n    svg\r\n      .selectAll('.episode')\r\n      .data(episodes)\r\n      .join('line')\r\n      .attrs({\r\n        class : 'episode',\r\n        x1 : episode => xScale(getDate(episode.air_date)),\r\n        x2 : episode => xScale(getDate(episode.air_date)),\r\n        y1 : height,\r\n        y2 : height\r\n      })\r\n      .transition()\r\n      .attrs({\r\n        stroke : episode => {\r\n          return episode.characters.includes(highlight)\r\n          ? 'blue'\r\n          : 'black'\r\n        },\r\n        y2 : episode => yScale(episode.characters.length)\r\n      });\r\n\r\n    return () => svg.interrupt();\r\n\r\n  }, [episodes, highlight]);\r\n  \r\n  return (\r\n    <svg\r\n    ref={svgRef}\r\n    style={{\r\n      borderRight: '2rem solid transparent',\r\n      borderTop: '1rem solid transparent',\r\n      overflow : 'visible'\r\n    }}>\r\n      <g className=\"xAxis\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\nconst getDate = date => {\r\n  date = date.split('-');\r\n  return new Date(date[2], date[0] - 1, date[1]);\r\n};\r\n\r\nconst useBreakingBadAPI = (query, callback) => {\r\n  \r\n  const savedCallback = useRef();\r\n\r\n  useEffect(() => {\r\n    savedCallback.current = callback;\r\n  }, [callback]);\r\n  \r\n  useEffect(() => {\r\n    \r\n    const controller = new AbortController(),\r\n          signal = controller.signal;\r\n\r\n    fetch(\r\n      'https://www.breakingbadapi.com/api/' + query + '=Breaking+Bad',\r\n      {signal})\r\n      .then(response => response.ok && response.json())\r\n      .then(savedCallback.current)\r\n      .catch(e => {\r\n        if (e.name === 'AbortError') {\r\n          console.log('Fetch was aborted');\r\n        } else {\r\n          console.warn(e);\r\n        }\r\n      });\r\n    \r\n    return () => controller.abort();\r\n  }, [query]);\r\n};"],"sourceRoot":""}